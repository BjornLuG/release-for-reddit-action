module.exports=function(t,e){"use strict";var n={};function __webpack_require__(e){if(n[e]){return n[e].exports}var r=n[e]={i:e,l:false,exports:{}};t[e].call(r.exports,r,r.exports,__webpack_require__);r.l=true;return r.exports}__webpack_require__.ab=__dirname+"/";function startup(){return __webpack_require__(104)}return startup()}({82:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:true});function toCommandValue(t){if(t===null||t===undefined){return""}else if(typeof t==="string"||t instanceof String){return t}return JSON.stringify(t)}e.toCommandValue=toCommandValue},87:function(t){t.exports=require("os")},102:function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)if(Object.hasOwnProperty.call(t,n))e[n]=t[n];e["default"]=t;return e};Object.defineProperty(e,"__esModule",{value:true});const s=r(n(747));const o=r(n(87));const i=n(82);function issueCommand(t,e){const n=process.env[`GITHUB_${t}`];if(!n){throw new Error(`Unable to find environment variable for file command ${t}`)}if(!s.existsSync(n)){throw new Error(`Missing file at path: ${n}`)}s.appendFileSync(n,`${i.toCommandValue(e)}${o.EOL}`,{encoding:"utf8"})}e.issueCommand=issueCommand},104:function(t,e,n){const r=n(211);const s=n(470);const o=n(554);const{readFileSync:i}=n(747);const{Octokit:a}=n(571);const u=n(470);const c=n(612);const p=n(442);const d=n(360).version;console.log(`Running twitter-together version ${d}`);class Main{constructor(){this.username=s.getInput("username",{required:true});this.password=s.getInput("password",{required:true});this.appId=s.getInput("app-id",{required:true});this.appSecret=s.getInput("app-secret",{required:true});this.subreddit=s.getInput("subreddit",{required:true});this.title=s.getInput("title",{required:true});this.flairId=s.getInput("flair-id");this.flairText=s.getInput("flair-text");this.comment=s.getInput("comment");this.notification=s.getInput("notification")==="true";this.retryRateLimit=+s.getInput("retry-rate-limit");this.userAgent=`Release for Reddit (by /u/${this.username})`;this.accessToken=""}async start(){await this.initAccessToken();const t=new a;const e=JSON.parse(i(process.env.GITHUB_EVENT_PATH,"utf8"));const n=process.env.GITHUB_REF;const r=process.env.GITHUB_SHA;const c={toolkit:u,octokit:t,payload:e,ref:n,sha:r,startedAt:(new Date).toISOString(),twitterCredentials:{consumer_key:process.env.TWITTER_API_KEY,consumer_secret:process.env.TWITTER_API_SECRET_KEY,access_token_key:process.env.TWITTER_ACCESS_TOKEN,access_token_secret:process.env.TWITTER_ACCESS_TOKEN_SECRET}};const p=await o(c);if(p.length===0){u.info("No new posts");return}this.text=p;console.log(p);const d=await this.submitPost();s.info(`View post at ${d.url}`);s.setOutput("postUrl",d.url);if(this.comment){const t=await this.commentPost(d.name);const e=`https://www.reddit.com${t.permalink}`;s.info(`View comment at ${e}`);s.setOutput("commentUrl",e);if(!this.notification){this.editSendReplies(t.name,false)}}}async initAccessToken(){const t=await this._post({host:"www.reddit.com",path:"/api/v1/access_token",auth:`${this.appId}:${this.appSecret}`},{grant_type:"password",username:this.username,password:this.password});this.accessToken=t["access_token"]}async submitPost(){const t=await this._retryIfRateLimit(async()=>{const t=await this._post({host:"oauth.reddit.com",path:`/api/submit`,headers:{Authorization:`Bearer ${this.accessToken}`}},{api_type:"json",resubmit:true,kind:"link",sr:this.subreddit,title:this.title,text:this.text,flair_id:this.flairId,flair_text:this.flairText,sendreplies:this.notification});if(t.json.errors.length){throw new Error(t.json.errors)}return t});return t.json.data}async commentPost(t){const e=await this._retryIfRateLimit(async()=>{const e=await this._post({host:"oauth.reddit.com",path:`/api/comment`,headers:{Authorization:`Bearer ${this.accessToken}`}},{api_type:"json",text:this.comment,thing_id:t});if(e.json.errors.length){throw new Error(e.json.errors)}return e});const n=e.json.data;if(n&&n.things&&n.things[0]){return n.things[0].data}return n}async editSendReplies(t,e){await this._retryIfRateLimit(async()=>{const n=await this._post({host:"oauth.reddit.com",path:`/api/sendreplies`,headers:{Authorization:`Bearer ${this.accessToken}`}},{id:t,state:e});if(n&&n.json&&n.json.errors&&n.json.errors.length){throw new Error(n.json.errors)}return n})}_post(t,e){const n=this._encodeForm(e);const s={...t,method:"POST",headers:{...t.headers,"User-Agent":this.userAgent,"Content-Type":"application/x-www-form-urlencoded","Content-Length":Buffer.byteLength(n)}};return new Promise((t,e)=>{const o=r.request(s,n=>{n.setEncoding("utf8");let r="";n.on("data",t=>{r+=t});n.on("error",t=>e(t));n.on("end",()=>t(JSON.parse(r)))});o.on("error",t=>e(t));o.write(n);o.end()})}async _retryIfRateLimit(t,e=this.retryRateLimit){try{return await t()}catch(n){const r=this._getRateLimitSeconds(n.message);if(r>0&&e>0){s.info(`Rate limit hit. Waiting ${r} seconds to retry...`);await this._wait(r*1e3);return await this._retryIfRateLimit(t,e-1)}throw n}}_getRateLimitSeconds(t){const e=t.match(/RATELIMIT.*try again in (\d*) (s|m)/);if(!e||e.length<3){return-1}let n=e[1];if(e[2]==="m"){n*=60}n+=60;return n}async _wait(t){return new Promise(e=>{setTimeout(()=>e(),t)})}_encodeForm(t){return Object.entries(t).map(t=>t.map(encodeURIComponent).join("=")).join("&")}}(new Main).start().catch(t=>s.setFailed(t.message))},211:function(t){t.exports=require("https")},360:function(){eval("require")("../package.json")},431:function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)if(Object.hasOwnProperty.call(t,n))e[n]=t[n];e["default"]=t;return e};Object.defineProperty(e,"__esModule",{value:true});const s=r(n(87));const o=n(82);function issueCommand(t,e,n){const r=new Command(t,e,n);process.stdout.write(r.toString()+s.EOL)}e.issueCommand=issueCommand;function issue(t,e=""){issueCommand(t,{},e)}e.issue=issue;const i="::";class Command{constructor(t,e,n){if(!t){t="missing.command"}this.command=t;this.properties=e;this.message=n}toString(){let t=i+this.command;if(this.properties&&Object.keys(this.properties).length>0){t+=" ";let e=true;for(const n in this.properties){if(this.properties.hasOwnProperty(n)){const r=this.properties[n];if(r){if(e){e=false}else{t+=","}t+=`${n}=${escapeProperty(r)}`}}}}t+=`${i}${escapeData(this.message)}`;return t}}function escapeData(t){return o.toCommandValue(t).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function escapeProperty(t){return o.toCommandValue(t).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}},442:function(){eval("require")("./push")},470:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){function adopt(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n||(n=Promise))(function(n,s){function fulfilled(t){try{step(r.next(t))}catch(t){s(t)}}function rejected(t){try{step(r["throw"](t))}catch(t){s(t)}}function step(t){t.done?n(t.value):adopt(t.value).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())})};var s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)if(Object.hasOwnProperty.call(t,n))e[n]=t[n];e["default"]=t;return e};Object.defineProperty(e,"__esModule",{value:true});const o=n(431);const i=n(102);const a=n(82);const u=s(n(87));const c=s(n(622));var p;(function(t){t[t["Success"]=0]="Success";t[t["Failure"]=1]="Failure"})(p=e.ExitCode||(e.ExitCode={}));function exportVariable(t,e){const n=a.toCommandValue(e);process.env[t]=n;const r=process.env["GITHUB_ENV"]||"";if(r){const e="_GitHubActionsFileCommandDelimeter_";const r=`${t}<<${e}${u.EOL}${n}${u.EOL}${e}`;i.issueCommand("ENV",r)}else{o.issueCommand("set-env",{name:t},n)}}e.exportVariable=exportVariable;function setSecret(t){o.issueCommand("add-mask",{},t)}e.setSecret=setSecret;function addPath(t){const e=process.env["GITHUB_PATH"]||"";if(e){i.issueCommand("PATH",t)}else{o.issueCommand("add-path",{},t)}process.env["PATH"]=`${t}${c.delimiter}${process.env["PATH"]}`}e.addPath=addPath;function getInput(t,e){const n=process.env[`INPUT_${t.replace(/ /g,"_").toUpperCase()}`]||"";if(e&&e.required&&!n){throw new Error(`Input required and not supplied: ${t}`)}return n.trim()}e.getInput=getInput;function setOutput(t,e){o.issueCommand("set-output",{name:t},e)}e.setOutput=setOutput;function setCommandEcho(t){o.issue("echo",t?"on":"off")}e.setCommandEcho=setCommandEcho;function setFailed(t){process.exitCode=p.Failure;error(t)}e.setFailed=setFailed;function isDebug(){return process.env["RUNNER_DEBUG"]==="1"}e.isDebug=isDebug;function debug(t){o.issueCommand("debug",{},t)}e.debug=debug;function error(t){o.issue("error",t instanceof Error?t.toString():t)}e.error=error;function warning(t){o.issue("warning",t instanceof Error?t.toString():t)}e.warning=warning;function info(t){process.stdout.write(t+u.EOL)}e.info=info;function startGroup(t){o.issue("group",t)}e.startGroup=startGroup;function endGroup(){o.issue("endgroup")}e.endGroup=endGroup;function group(t,e){return r(this,void 0,void 0,function*(){startGroup(t);let n;try{n=yield e()}finally{endGroup()}return n})}e.group=group;function saveState(t,e){o.issueCommand("save-state",{name:t},e)}e.saveState=saveState;function getState(t){return process.env[`STATE_${t}`]||""}e.getState=getState},554:function(t,e,n){t.exports=parseText;const{resolve:r}=n(622);const{readFileSync:s}=n(747);async function parseText({payload:t,octokit:e}){const{data:{files:n}}=await e.request("GET /repos/:owner/:repo/compare/:base...:head",{owner:t.repository.owner.login,repo:t.repository.name,base:t.before,head:t.after});return n.filter(t=>t.status==="added"&&/^posts\/.*\.post/.test(t.filename)).map(t=>{const e=s(r(process.env.GITHUB_WORKSPACE,t.filename),"utf8").trim();return{text:e,filename:t.filename}})}},571:function(){eval("require")("@octokit/action")},612:function(){eval("require")("./pull-request")},622:function(t){t.exports=require("path")},747:function(t){t.exports=require("fs")}});